<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidConnect App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'display': ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    colors: {
                        'brand-teal': '#0B4C5F',
                        'brand-orange': '#F39C12',
                        'brand-accent': '#2DD0D2'
                    }
                }
            }
        }
    </script>
    <style>
        .view { display: none; }
        .view.active { display: flex; flex-direction: column; height: 100%; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-in {
            animation: fadeIn 0.25s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .modal {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(11, 76, 95, 0.4);
            backdrop-filter: blur(4px);
            z-index: 200;
            align-items: flex-end;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            width: 100%;
            border-top-left-radius: 2.5rem;
            border-top-right-radius: 2.5rem;
            padding: 2rem;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }
        .modal.active .modal-content { transform: translateY(0); }

        /* Notification Panel */
        #notification-panel {
            display: none;
            position: absolute;
            top: 70px;
            right: 20px;
            width: 280px;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 150;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        #notification-panel.active { display: block; animation: slideDown 0.2s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Document Placeholder */
        .doc-line { height: 10px; background: #e2e8f0; border-radius: 4px; margin-bottom: 8px; }
        .doc-line.short { width: 60%; }
        .doc-line.long { width: 100%; }

        /* Ajustement pour que tout rentre dans l'√©cran */
        #app-frame {
            height: calc(100vh - 40px);
            max-height: 844px;
        }

        /* Toast Notification */
        .toast {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 1000;
            width: max-content;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body class="bg-slate-100 font-sans flex items-center justify-center min-h-screen p-4">

<!-- Cadre Mobile -->
<div id="app-frame" class="relative w-full max-w-[400px] bg-white shadow-2xl overflow-hidden md:rounded-[3rem] md:border-[8px] md:border-slate-900 flex flex-col">

    <!-- Toast Notification Container -->
    <div id="toast" class="toast">
        <i class="fa-solid fa-check-circle text-brand-accent"></i>
        <span id="toast-msg">Action effectu√©e</span>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel">
        <div class="p-4 border-b border-slate-100 bg-slate-50">
            <h4 class="font-bold text-brand-teal text-sm">Notifications</h4>
        </div>
        <div class="max-h-60 overflow-y-auto">
            <div class="p-4 border-b border-slate-50 hover:bg-slate-50 transition-colors cursor-pointer" onclick="openChat(1); toggleNotifications()">
                <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 rounded-full bg-brand-orange"></div>
                    <p class="text-xs font-bold text-slate-800">Nouveau message</p>
                </div>
                <p class="text-[10px] text-slate-500">Agence Paris : "Bonjour Amandine..."</p>
            </div>
            <div class="p-4 border-b border-slate-50 hover:bg-slate-50 transition-colors cursor-pointer" onclick="switchTab('planning'); toggleNotifications()">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa-regular fa-calendar text-brand-teal text-xs"></i>
                    <p class="text-xs font-bold text-slate-800">Rappel Mission</p>
                </div>
                <p class="text-[10px] text-slate-500">Famille Dupont demain √† 16h30</p>
            </div>
            <div class="p-4 hover:bg-slate-50 transition-colors cursor-pointer" onclick="switchTab('docs'); toggleNotifications()">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa-solid fa-triangle-exclamation text-red-500 text-xs"></i>
                    <p class="text-xs font-bold text-slate-800">Document Manquant</p>
                </div>
                <p class="text-[10px] text-slate-500">Veuillez mettre √† jour votre CNI.</p>
            </div>
        </div>
    </div>

    <!-- Zone de contenu -->
    <main id="content-area" class="flex-1 overflow-hidden relative">

        <!-- VUE ACCUEIL -->
        <div id="view-home" class="view active fade-in overflow-y-auto hide-scrollbar pb-24">
            <header class="flex justify-between items-center px-6 pt-8 mb-6">
                <img src="Image/logoKidConnect.png" alt="Logo" class="h-10 w-auto" onerror="this.src='https://placehold.co/150x50?text=KidConnect'">
                <div class="flex items-center gap-3">
                    <!-- Indicateur de statut (Dynamique) -->
                    <div id="status-indicator" class="px-3 py-1 rounded-full bg-green-100 text-green-700 text-[10px] font-bold uppercase tracking-wide flex items-center gap-1 cursor-pointer" onclick="openModal('dispo')">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        Dispo
                    </div>
                    <button onclick="toggleNotifications()" class="relative p-2 bg-slate-100 rounded-full text-slate-600 active:scale-95 transition-transform">
                        <i class="fa-regular fa-bell text-lg"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-brand-orange rounded-full border-2 border-white"></span>
                    </button>
                </div>
            </header>

            <section class="px-6 mb-8">
                <h1 class="text-2xl font-bold text-brand-teal">Bonjour, <span class="user-firstname">Amandine</span> üëã</h1>
                <p class="text-slate-500">Vous avez <span class="font-bold text-brand-teal">2 missions</span> aujourd'hui.</p>
            </section>

            <!-- Carte Mission Suivante -->
            <section class="px-6 mb-8">
                <div class="bg-brand-teal text-white p-6 rounded-[2rem] shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                    <p class="text-white/70 text-xs font-bold uppercase tracking-wider mb-2">Prochaine Mission</p>
                    <h2 class="text-xl font-bold mb-4 font-display">Famille Dupont - Sortie d'√©cole</h2>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3 text-sm">
                            <i class="fa-regular fa-clock text-brand-orange"></i>
                            <span>16:30 - 18:30 (2h)</span>
                        </div>
                        <div class="flex items-center gap-3 text-sm">
                            <i class="fa-solid fa-location-dot text-brand-orange"></i>
                            <span>15 rue de la Paix, Paris 01</span>
                        </div>
                    </div>
                    <button onclick="openMissionDetail(1)" class="mt-6 w-full bg-brand-orange text-white py-4 rounded-xl font-bold shadow-lg shadow-black/20 active:scale-95 transition-transform">
                        Voir les d√©tails
                    </button>
                </div>
            </section>

            <!-- Actions Rapides -->
            <section class="px-6 grid grid-cols-2 gap-4 mb-8">
                <button onclick="openModal('dispo')" class="text-left bg-slate-50 p-5 rounded-3xl border border-slate-100 hover:bg-slate-100 transition-colors active:scale-95">
                    <div class="w-10 h-10 bg-teal-100 text-teal-600 rounded-xl flex items-center justify-center mb-3 text-lg">
                        <i class="fa-regular fa-calendar-check"></i>
                    </div>
                    <p class="font-bold text-slate-800">Dispos</p>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">G√©rer mes cr√©neaux</p>
                </button>
                <button onclick="openModal('urgence')" class="text-left bg-slate-50 p-5 rounded-3xl border border-slate-100 hover:bg-slate-100 transition-colors active:scale-95">
                    <div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center mb-3 text-lg">
                        <i class="fa-solid fa-phone"></i>
                    </div>
                    <p class="font-bold text-slate-800">Urgence</p>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">Aide imm√©diate</p>
                </button>
            </section>

            <!-- Statut Documents -->
            <section class="px-6">
                <button onclick="switchTab('docs')" class="w-full bg-white border border-slate-100 p-5 rounded-3xl shadow-sm flex items-center justify-between hover:bg-slate-50 transition-colors active:scale-95">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-green-50 text-green-600 rounded-full flex items-center justify-center text-xl">
                            <i class="fa-regular fa-circle-check"></i>
                        </div>
                        <div class="text-left">
                            <p class="font-bold text-slate-800">Dossier Complet</p>
                            <p class="text-xs text-slate-500">6/6 documents valid√©s</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right text-slate-300"></i>
                </button>
            </section>
        </div>

        <!-- VUE D√âTAILS MISSION -->
        <div id="view-mission-detail" class="view fade-in overflow-y-auto hide-scrollbar pb-10">
            <header class="sticky top-0 bg-white/95 backdrop-blur-md p-6 flex items-center gap-4 z-20 border-b border-slate-100">
                <button onclick="goBack()" class="p-2 bg-slate-100 rounded-xl text-brand-teal active:bg-slate-200">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 class="text-lg font-bold text-brand-teal font-display truncate" id="detail-mission-title">Mission</h2>
            </header>

            <div class="p-6 pt-6 space-y-6">
                <div class="flex items-center gap-3">
                    <span class="px-3 py-1 bg-brand-accent/20 text-brand-teal text-xs font-bold rounded-full uppercase" id="detail-mission-tag">Confirm√©</span>
                    <span class="px-3 py-1 bg-orange-100 text-brand-orange text-xs font-bold rounded-full uppercase" id="detail-mission-type">Type</span>
                </div>

                <div class="space-y-4">
                    <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <i class="fa-solid fa-clock text-brand-orange text-xl mt-1"></i>
                        <div>
                            <p class="font-bold text-slate-800" id="detail-mission-time">Horaire</p>
                            <p class="text-sm text-slate-500">Pr√©sence obligatoire</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <i class="fa-solid fa-location-dot text-brand-orange text-xl mt-1"></i>
                        <div class="flex-1">
                            <p class="font-bold text-slate-800" id="detail-mission-address">Adresse</p>
                            <p class="text-sm text-slate-500 mb-3">Code: 1234A ‚Ä¢ √âtage 2</p>
                            <button onclick="showToast('Itin√©raire lanc√© dans Maps')" class="text-xs bg-brand-teal text-white px-4 py-2 rounded-lg font-bold active:scale-95 transition-transform">
                                <i class="fa-solid fa-map mr-1"></i> Itin√©raire
                            </button>
                        </div>
                    </div>
                </div>

                <div id="detail-mission-kids-container"></div>

                <div class="bg-orange-50 border border-orange-200 p-4 rounded-2xl flex gap-3">
                    <i class="fa-solid fa-circle-exclamation text-brand-orange text-lg"></i>
                    <div>
                        <p class="font-bold text-orange-900 text-sm">Attention : Allergie</p>
                        <p class="text-orange-800 text-xs leading-relaxed">Arachides. EpiPen dans le sac √† dos rouge.</p>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-brand-teal mb-3 uppercase text-xs tracking-widest">T√¢ches √† effectuer</h4>
                    <ul class="space-y-3" id="detail-mission-tasks"></ul>
                </div>
            </div>
        </div>

        <!-- VUE VISIONNEUSE DOCUMENT (NOUVEAU) -->
        <div id="view-doc-viewer" class="view fade-in overflow-hidden h-full bg-slate-50">
            <header class="p-4 bg-white border-b border-slate-100 flex items-center justify-between shadow-sm z-10">
                <button onclick="switchTab('docs')" class="p-2 bg-slate-50 rounded-xl text-slate-600 active:bg-slate-100">
                    <i class="fa-solid fa-times"></i>
                </button>
                <h2 class="text-sm font-bold text-slate-800 truncate" id="viewer-title">Document</h2>
                <button onclick="showToast('Document t√©l√©charg√©')" class="p-2 text-brand-teal">
                    <i class="fa-solid fa-download"></i>
                </button>
            </header>
            <div class="flex-1 p-6 flex flex-col items-center justify-start overflow-y-auto">
                <div class="bg-white p-8 shadow-xl w-full max-w-[300px] min-h-[400px] rounded-sm flex flex-col gap-4">
                    <!-- Simulation de contenu de document -->
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-4">
                        <img src="Image/logoKidConnect.png" class="h-6 w-auto grayscale opacity-50" onerror="this.style.display='none'">
                        <div class="h-3 bg-slate-200 w-24 rounded"></div>
                    </div>
                    <div class="doc-line long"></div>
                    <div class="doc-line long"></div>
                    <div class="doc-line short"></div>
                    <div class="h-8"></div>
                    <div class="doc-line long"></div>
                    <div class="doc-line long"></div>
                    <div class="doc-line long"></div>
                    <div class="doc-line short"></div>
                    <div class="h-8"></div>
                    <div class="flex justify-between mt-auto pt-8 border-t border-slate-100">
                        <div class="h-8 w-20 bg-slate-100 rounded"></div>
                        <div class="h-8 w-8 bg-brand-teal/20 rounded-full"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VUE PLANNING -->
        <div id="view-planning" class="view fade-in overflow-y-auto hide-scrollbar pb-24">
            <header class="p-6 pt-8 mb-4">
                <h1 class="text-2xl font-bold text-brand-teal font-display">Mon Planning</h1>
            </header>
            <div class="px-6 mb-6">
                <div class="bg-slate-50 p-1 rounded-2xl flex">
                    <button onclick="filterPlanning('Juin', this)" class="month-btn flex-1 py-2 bg-white rounded-xl shadow-sm text-brand-teal font-bold text-sm transition-all">Juin</button>
                    <button onclick="filterPlanning('Juil', this)" class="month-btn flex-1 py-2 text-slate-400 font-bold text-sm transition-all">Juil</button>
                    <button onclick="filterPlanning('Ao√ªt', this)" class="month-btn flex-1 py-2 text-slate-400 font-bold text-sm transition-all">Ao√ªt</button>
                </div>
            </div>
            <div id="planning-list" class="px-6 space-y-4"></div>
        </div>

        <!-- VUE MESSAGES -->
        <div id="view-messages" class="view fade-in overflow-y-auto hide-scrollbar pb-24">
            <header class="p-6 pt-8 mb-4">
                <h1 class="text-2xl font-bold text-brand-teal font-display">Messagerie</h1>
            </header>
            <div class="px-6 mb-6">
                <div class="relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" placeholder="Rechercher..." class="w-full pl-12 pr-4 py-4 bg-slate-50 border-none rounded-2xl focus:ring-2 focus:ring-brand-teal/20 outline-none">
                </div>
            </div>
            <div id="conversations-list" class="px-6 space-y-2"></div>
        </div>

        <!-- VUE CHAT D√âTAIL -->
        <div id="view-chat-detail" class="view fade-in overflow-hidden h-full">
            <header class="p-4 border-b border-slate-100 flex items-center gap-3 bg-white z-10">
                <button onclick="switchTab('messages')" class="p-2 text-brand-teal active:bg-slate-50 rounded-xl">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <div class="w-10 h-10 bg-brand-teal/10 rounded-full flex items-center justify-center text-brand-teal font-bold text-sm shrink-0" id="chat-avatar">P</div>
                <div>
                    <p id="chat-title" class="font-bold text-slate-800 leading-none">Agence</p>
                    <p class="text-[10px] text-green-500 font-bold uppercase tracking-wider">En ligne</p>
                </div>
            </header>
            <div id="chat-messages-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50"></div>
            <div class="p-4 bg-white border-t border-slate-100 flex gap-2">
                <input type="text" id="chat-input" placeholder="√âcrire un message..." class="flex-1 bg-slate-50 px-4 py-3 rounded-xl outline-none text-sm border border-transparent focus:border-brand-teal/30 transition-colors" onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-brand-teal text-white w-12 h-12 rounded-xl flex items-center justify-center active:scale-95 transition-transform shadow-lg shadow-brand-teal/20">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- VUE DOCUMENTS -->
        <div id="view-docs" class="view fade-in overflow-y-auto hide-scrollbar pb-24">
            <header class="p-6 pt-8 mb-4">
                <h1 class="text-2xl font-bold text-brand-teal font-display">Mes Documents</h1>
            </header>
            <div class="px-6 mb-8">
                <div class="bg-orange-50 border border-orange-100 p-5 rounded-3xl flex gap-4">
                    <i class="fa-solid fa-triangle-exclamation text-brand-orange mt-1 text-xl"></i>
                    <div>
                        <p class="text-sm font-bold text-orange-900 mb-1">Action requise</p>
                        <p class="text-xs text-orange-800 leading-relaxed">
                            Votre photo d'identit√© expire bient√¥t. Veuillez la mettre √† jour.
                        </p>
                    </div>
                </div>
            </div>
            <div class="px-6 space-y-4">
                <div class="flex items-center justify-between p-5 bg-white rounded-3xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center text-xl"><i class="fa-regular fa-file-lines"></i></div>
                        <div>
                            <p class="text-sm font-bold text-slate-800">Contrat de travail CDI</p>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Ajout√© le 02/03/2023</p>
                        </div>
                    </div>
                    <button onclick="openDocument('Contrat de travail CDI')" class="bg-brand-teal/10 text-brand-teal text-xs font-bold px-4 py-2 rounded-lg active:scale-95 transition-transform">VOIR</button>
                </div>
                <div class="flex items-center justify-between p-5 bg-white rounded-3xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-green-50 text-green-500 rounded-2xl flex items-center justify-center text-xl"><i class="fa-regular fa-file-pdf"></i></div>
                        <div>
                            <p class="text-sm font-bold text-slate-800">Fiche de paie - Mai 2024</p>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Ajout√© le 05/06/2024</p>
                        </div>
                    </div>
                    <button onclick="openDocument('Fiche de paie - Mai 2024')" class="bg-brand-teal/10 text-brand-teal text-xs font-bold px-4 py-2 rounded-lg active:scale-95 transition-transform">VOIR</button>
                </div>
            </div>
        </div>

        <!-- VUE PROFIL -->
        <div id="view-profile" class="view fade-in overflow-y-auto hide-scrollbar pb-24">
            <header class="p-6 pt-8 flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-brand-teal font-display">Mon Profil</h1>
                <button id="edit-profile-btn" onclick="toggleProfileEdit()" class="px-4 py-2 bg-slate-100 text-brand-teal rounded-xl font-bold text-xs uppercase tracking-wider active:scale-95">Modifier</button>
            </header>
            <div class="px-6 flex flex-col items-center mb-8 text-center">
                <!-- Icone Profil modifiable -->
                <button onclick="showToast('Changer la photo...')" class="w-20 h-20 bg-brand-teal/10 rounded-full flex items-center justify-center text-brand-teal text-3xl font-bold mb-4 shadow-inner active:scale-95 transition-transform relative group">
                    <i class="fa-regular fa-user"></i>
                    <div class="absolute inset-0 bg-black/10 rounded-full hidden group-hover:flex items-center justify-center text-xs text-white">Edit</div>
                </button>
                <h2 id="profile-full-name" class="text-2xl font-bold text-brand-teal">Amandine Lemaire</h2>
                <p class="text-slate-400 text-sm italic">Intervenante KidConnect depuis 2023</p>
            </div>
            <!-- Formulaire Profil -->
            <div id="profile-form-view" class="px-6 space-y-6">
                <div class="space-y-4">
                    <div class="info-block space-y-4">
                        <div class="p-5 bg-slate-50 rounded-[2rem] border border-slate-100">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3">Coordonn√©es</p>
                            <div class="space-y-4">
                                <p class="flex items-center gap-3 text-sm font-medium text-slate-700"><i class="fa-regular fa-envelope text-brand-teal w-5"></i><span id="display-email">amandine.l@email.com</span></p>
                                <p class="flex items-center gap-3 text-sm font-medium text-slate-700"><i class="fa-solid fa-phone text-brand-teal w-5"></i><span id="display-phone">06 12 34 56 78</span></p>
                                <p class="flex items-center gap-3 text-sm font-medium text-slate-700"><i class="fa-solid fa-location-dot text-brand-teal w-5"></i><span id="display-address">Paris, France</span></p>
                            </div>
                        </div>
                        <div class="p-5 bg-slate-50 rounded-[2rem] border border-slate-100">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Comp√©tences</p>
                            <div class="flex flex-wrap gap-2 mt-3">
                                <span class="px-3 py-1 bg-white border border-brand-teal/20 text-brand-teal rounded-lg text-xs font-bold">BAFA</span>
                                <span class="px-3 py-1 bg-white border border-brand-teal/20 text-brand-teal rounded-lg text-xs font-bold">Premier Secours</span>
                                <span class="px-3 py-1 bg-white border border-brand-teal/20 text-brand-teal rounded-lg text-xs font-bold">Non-fumeuse</span>
                            </div>
                        </div>
                    </div>
                    <div id="edit-block" class="hidden space-y-4">
                        <div class="p-5 bg-white rounded-[2rem] border-2 border-brand-teal/30 shadow-sm space-y-4">
                            <div><label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Pr√©nom</label><input type="text" id="input-firstname" value="Amandine" class="w-full bg-slate-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-brand-teal/20 border border-slate-100 text-sm"></div>
                            <div><label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Nom</label><input type="text" id="input-lastname" value="Lemaire" class="w-full bg-slate-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-brand-teal/20 border border-slate-100 text-sm"></div>
                            <div><label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Email</label><input type="email" id="input-email" value="amandine.l@email.com" class="w-full bg-slate-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-brand-teal/20 border border-slate-100 text-sm"></div>
                            <div><label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">T√©l√©phone</label><input type="text" id="input-phone" value="06 12 34 56 78" class="w-full bg-slate-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-brand-teal/20 border border-slate-100 text-sm"></div>
                            <button onclick="saveProfileChanges()" class="w-full bg-brand-teal text-white py-4 rounded-xl font-bold shadow-lg shadow-black/10 transition-all active:scale-95">Enregistrer</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 py-10">
                <button class="w-full py-4 bg-red-50 text-red-500 rounded-2xl font-bold flex items-center justify-center gap-3 active:scale-95 transition-transform border border-red-100">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i> Se d√©connecter
                </button>
            </div>
        </div>

    </main>

    <!-- Barre de Navigation Basse -->
    <nav id="bottom-nav" class="absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-slate-100 flex justify-around items-center h-20 px-4 pb-2 z-50">
        <button onclick="switchTab('home')" class="nav-btn flex flex-col items-center gap-1 text-brand-teal active:scale-90 transition-transform" data-target="home">
            <i class="fa-solid fa-house text-xl"></i>
            <span class="text-[10px] font-bold">Accueil</span>
        </button>
        <button onclick="switchTab('planning')" class="nav-btn flex flex-col items-center gap-1 text-slate-400 active:scale-90 transition-transform" data-target="planning">
            <i class="fa-regular fa-calendar text-xl"></i>
            <span class="text-[10px] font-bold">Planning</span>
        </button>
        <button onclick="switchTab('messages')" class="nav-btn flex flex-col items-center gap-1 text-slate-400 active:scale-90 transition-transform" data-target="messages">
            <div class="relative">
                <i class="fa-regular fa-comment-dots text-xl"></i>
                <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span>
            </div>
            <span class="text-[10px] font-bold">Messages</span>
        </button>
        <button onclick="switchTab('docs')" class="nav-btn flex flex-col items-center gap-1 text-slate-400 active:scale-90 transition-transform" data-target="docs">
            <i class="fa-regular fa-file-lines text-xl"></i>
            <span class="text-[10px] font-bold">Docs</span>
        </button>
        <button onclick="switchTab('profile')" class="nav-btn flex flex-col items-center gap-1 text-slate-400 active:scale-90 transition-transform" data-target="profile">
            <i class="fa-regular fa-user text-xl"></i>
            <span class="text-[10px] font-bold">Profil</span>
        </button>
    </nav>

    <!-- MODALS -->
    <!-- Urgence Modal -->
    <div id="modal-urgence" class="modal" onclick="closeModal('urgence')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-slate-200 rounded-full mx-auto mb-6"></div>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-red-500 mx-auto mb-4">
                    <i class="fa-solid fa-bell text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-brand-teal mb-2">Besoin d'aide ?</h3>
                <p class="text-sm text-slate-500">Contactez imm√©diatement votre agence r√©f√©rente en cas de probl√®me.</p>
            </div>
            <div class="space-y-4">
                <a href="tel:0145820000" class="flex items-center justify-between p-5 bg-brand-teal text-white rounded-2xl font-bold active:scale-95 transition-transform shadow-lg">
                    <span>Appeler l'Agence Paris</span>
                    <i class="fa-solid fa-phone"></i>
                </a>
                <button onclick="closeModal('urgence')" class="w-full py-4 text-slate-400 font-bold hover:bg-slate-50 rounded-2xl">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Dispo Modal -->
    <div id="modal-dispo" class="modal" onclick="closeModal('dispo')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-slate-200 rounded-full mx-auto mb-6"></div>
            <h3 class="text-xl font-bold text-brand-teal mb-2">Mise √† jour des disponibilit√©s</h3>
            <p class="text-sm text-slate-500 mb-6">Indiquez √† l'agence votre statut pour les prochains jours.</p>
            <div class="grid grid-cols-2 gap-3 mb-8">
                <button id="btn-dispo-on" onclick="setDispo(true)" class="p-4 border-2 border-brand-accent rounded-2xl text-brand-teal font-bold bg-brand-accent/10 transition-all">Dispo demain</button>
                <button id="btn-dispo-off" onclick="setDispo(false)" class="p-4 border border-slate-100 rounded-2xl text-slate-600 font-bold hover:bg-slate-50 transition-all">Indisponible</button>
            </div>
            <button onclick="saveDispo()" class="w-full bg-brand-teal text-white py-4 rounded-2xl font-bold shadow-lg shadow-brand-teal/20 active:scale-95 transition-transform">Enregistrer</button>
        </div>
    </div>
</div>

<script>
    const db = {
        missions: [
            { id: 1, family: "Famille Dupont", type: "Garde", date: "11 Juin", time: "16:30", address: "15 rue de la Paix, Paris 01", kids: ["L√©o, 6 ans"], tasks: ["Aide aux devoirs", "Go√ªter"] },
            { id: 2, family: "Famille Martin", type: "M√©nage", date: "12 Juin", time: "09:00", address: "8 bd Haussmann, Paris 09", tasks: ["Aspirateur", "Repassage"] },
            { id: 3, family: "Famille Leroy", type: "Garde", date: "12 Juil", time: "17:00", address: "22 av. Victor Hugo, Paris 16", kids: ["Emma, 4 ans", "Tom, 8 ans"], tasks: ["Parc", "Bain"] }
        ],
        chats: [
            { id: 1, name: "Agence Paris Centre", avatar: "P", unread: 2, time: "10:42", messages: [{ sender: "bot", text: "Bonjour Amandine, nous avons une nouvelle mission pour vous demain √† 16h30." }, { sender: "bot", text: "√ätes-vous disponible ?" }] },
            { id: 2, name: "Agence Lyon Sud", avatar: "L", unread: 0, time: "Hier", messages: [{ sender: "bot", text: "Merci pour l'envoi de votre RIB." }, { sender: "user", text: "Pas de souci, bonne journ√©e !" }] }
        ],
        currentChatId: null,
        isAvailable: true
    };

    let isEditingProfile = false;
    let selectedDispo = true;

    // --- NAVIGATION ---
    function switchTab(tabId) {
        document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
        document.getElementById('view-' + tabId).classList.add('active');

        const bottomNav = document.getElementById('bottom-nav');
        if (tabId === 'chat-detail' || tabId === 'mission-detail' || tabId === 'doc-viewer') {
            bottomNav.style.display = 'none';
        } else {
            bottomNav.style.display = 'flex';
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if (btn.getAttribute('data-target') === tabId) {
                    btn.classList.replace('text-slate-400', 'text-brand-teal');
                } else {
                    btn.classList.replace('text-brand-teal', 'text-slate-400');
                }
            });
        }

        if (tabId === 'planning') renderPlanning('Juin');
        if (tabId === 'messages') renderConversations();
        document.getElementById('content-area').scrollTop = 0;
        if (tabId !== 'profile' && isEditingProfile) toggleProfileEdit();
    }

    function goBack() {
        const currentView = document.querySelector('.view.active').id;
        if (currentView === 'view-chat-detail') switchTab('messages');
        if (currentView === 'view-mission-detail') switchTab('home');
    }

    // --- NOTIFICATIONS & TOAST ---
    function toggleNotifications() {
        document.getElementById('notification-panel').classList.toggle('active');
    }

    function showToast(message) {
        const toast = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // --- DOCUMENT VIEWER ---
    function openDocument(docName) {
        document.getElementById('viewer-title').innerText = docName;
        switchTab('doc-viewer');
    }

    // --- PLANNING ---
    function renderPlanning(month) {
        const list = document.getElementById('planning-list');
        list.innerHTML = "";
        const filtered = db.missions.filter(m => m.date.includes(month));
        if (filtered.length === 0) { list.innerHTML = `<p class="text-center text-slate-400 mt-10">Aucune mission ce mois-ci.</p>`; return; }
        filtered.forEach(m => {
            const colorClass = m.type === 'Garde' ? 'bg-brand-accent' : 'bg-brand-orange';
            list.innerHTML += `
                    <div onclick="openMissionDetail(${m.id})" class="flex gap-4 items-center bg-white p-5 rounded-3xl border border-slate-100 shadow-sm active:scale-[0.98] transition-all cursor-pointer">
                        <div class="text-center w-12 shrink-0"><p class="text-[10px] font-bold text-slate-400 uppercase">${m.date.split(' ')[1]}</p><p class="text-xl font-black text-brand-teal">${m.date.split(' ')[0]}</p></div>
                        <div class="w-1.5 h-12 rounded-full ${colorClass}"></div>
                        <div class="flex-1"><p class="font-bold text-slate-800">${m.family}</p><p class="text-xs text-slate-500">${m.type} ‚Ä¢ ${m.time}</p></div>
                        <i class="fa-solid fa-chevron-right text-slate-300"></i>
                    </div>`;
        });
    }

    function filterPlanning(month, btn) {
        document.querySelectorAll('.month-btn').forEach(b => { b.classList.remove('bg-white', 'shadow-sm', 'text-brand-teal'); b.classList.add('text-slate-400'); });
        btn.classList.add('bg-white', 'shadow-sm', 'text-brand-teal'); btn.classList.remove('text-slate-400');
        renderPlanning(month);
    }

    function openMissionDetail(id) {
        const mission = db.missions.find(m => m.id === id);
        if (!mission) return;
        document.getElementById('detail-mission-title').innerText = mission.family;
        document.getElementById('detail-mission-type').innerText = mission.type;
        document.getElementById('detail-mission-time').innerText = mission.date + " - " + mission.time;
        document.getElementById('detail-mission-address').innerText = mission.address;
        const taskList = document.getElementById('detail-mission-tasks');
        taskList.innerHTML = "";
        mission.tasks.forEach(t => { taskList.innerHTML += `<li class="flex items-start gap-3 text-sm text-slate-600"><i class="fa-solid fa-check text-brand-accent mt-1"></i><span>${t}</span></li>`; });
        const kidsContainer = document.getElementById('detail-mission-kids-container');
        if (mission.type === 'Garde' && mission.kids) {
            kidsContainer.innerHTML = `<h4 class="font-bold text-brand-teal mb-3 uppercase text-xs tracking-widest">Enfants √† garder</h4>`;
            mission.kids.forEach(k => { kidsContainer.innerHTML += `<div class="p-4 border border-slate-100 rounded-2xl flex items-center gap-4 bg-white mb-2"><div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-xl">üë∂</div><p class="font-bold">${k}</p></div>`; });
        } else { kidsContainer.innerHTML = ""; }
        switchTab('mission-detail');
    }

    // --- MESSAGERIE ---
    function renderConversations() {
        const list = document.getElementById('conversations-list');
        list.innerHTML = "";
        db.chats.forEach(chat => {
            const bgClass = chat.avatar === 'P' ? 'bg-brand-teal/10 text-brand-teal' : 'bg-brand-orange/10 text-brand-orange';
            const badge = chat.unread > 0 ? `<div class="w-6 h-6 bg-brand-teal text-white text-[10px] flex items-center justify-center rounded-full font-bold">${chat.unread}</div>` : '';
            list.innerHTML += `<div onclick="openChat(${chat.id})" class="py-4 px-2 flex items-center gap-4 rounded-2xl hover:bg-slate-50 transition-colors cursor-pointer"><div class="w-14 h-14 ${bgClass} rounded-full flex items-center justify-center font-bold text-lg shrink-0">${chat.avatar}</div><div class="flex-1 min-w-0"><div class="flex justify-between mb-1"><p class="font-bold text-slate-800 truncate">${chat.name}</p><p class="text-[10px] font-bold ${chat.unread ? 'text-brand-teal' : 'text-slate-400'}">${chat.time}</p></div><p class="text-sm text-slate-500 truncate ${chat.unread ? 'font-bold' : ''}">${chat.messages[chat.messages.length - 1].text}</p></div>${badge}</div>`;
        });
    }

    function openChat(id) {
        db.currentChatId = id;
        const chat = db.chats.find(c => c.id === id);
        chat.unread = 0;
        document.getElementById('chat-title').innerText = chat.name;
        document.getElementById('chat-avatar').innerText = chat.avatar;
        document.getElementById('chat-avatar').className = `w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shrink-0 ${chat.avatar === 'P' ? 'bg-brand-teal/10 text-brand-teal' : 'bg-brand-orange/10 text-brand-orange'}`;
        renderMessages(chat);
        switchTab('chat-detail');
    }

    function renderMessages(chat) {
        const container = document.getElementById('chat-messages-container');
        container.innerHTML = "";
        chat.messages.forEach(msg => {
            const align = msg.sender === 'user' ? 'justify-end' : 'justify-start';
            const style = msg.sender === 'user' ? 'bg-brand-teal text-white rounded-br-none' : 'bg-white rounded-bl-none text-slate-800';
            container.innerHTML += `<div class="flex ${align} fade-in"><div class="${style} p-3 rounded-2xl shadow-sm max-w-[80%] text-sm">${msg.text}</div></div>`;
        });
        container.scrollTop = container.scrollHeight;
    }

    function sendMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text || !db.currentChatId) return;
        const chat = db.chats.find(c => c.id === db.currentChatId);
        chat.messages.push({ sender: "user", text: text });
        renderMessages(chat);
        input.value = "";
        setTimeout(() => { chat.messages.push({ sender: "bot", text: "Message bien re√ßu, merci !" }); renderMessages(chat); showToast("Nouveau message re√ßu"); }, 1500);
    }

    // --- DISPO & MODALS ---
    function setDispo(val) {
        selectedDispo = val;
        const btnOn = document.getElementById('btn-dispo-on');
        const btnOff = document.getElementById('btn-dispo-off');
        if (val) {
            btnOn.classList.add('border-brand-accent', 'bg-brand-accent/10', 'text-brand-teal'); btnOn.classList.remove('border-slate-100', 'text-slate-600');
            btnOff.classList.remove('border-brand-orange', 'bg-brand-orange/10', 'text-brand-orange'); btnOff.classList.add('border-slate-100', 'text-slate-600');
        } else {
            btnOff.classList.add('border-brand-orange', 'bg-brand-orange/10', 'text-brand-orange'); btnOff.classList.remove('border-slate-100', 'text-slate-600');
            btnOn.classList.remove('border-brand-accent', 'bg-brand-accent/10', 'text-brand-teal'); btnOn.classList.add('border-slate-100', 'text-slate-600');
        }
    }

    function saveDispo() {
        db.isAvailable = selectedDispo;
        const indicator = document.getElementById('status-indicator');
        if (db.isAvailable) {
            indicator.className = "px-3 py-1 rounded-full bg-green-100 text-green-700 text-[10px] font-bold uppercase tracking-wide flex items-center gap-1 cursor-pointer";
            indicator.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span> Dispo`;
        } else {
            indicator.className = "px-3 py-1 rounded-full bg-slate-100 text-slate-500 text-[10px] font-bold uppercase tracking-wide flex items-center gap-1 cursor-pointer";
            indicator.innerHTML = `<span class="w-2 h-2 rounded-full bg-slate-400"></span> Indispo`;
        }
        closeModal('dispo');
        showToast("Disponibilit√© mise √† jour");
    }

    function openModal(id) { document.getElementById('modal-' + id).classList.add('active'); }
    function closeModal(id) { document.getElementById('modal-' + id).classList.remove('active'); }

    // --- PROFIL ---
    function toggleProfileEdit() {
        isEditingProfile = !isEditingProfile;
        const editBlock = document.getElementById('edit-block');
        const infoBlock = document.querySelector('.info-block');
        const editBtn = document.getElementById('edit-profile-btn');
        if (isEditingProfile) {
            editBlock.classList.remove('hidden'); infoBlock.classList.add('hidden'); editBtn.innerText = "Annuler";
            editBtn.classList.replace('bg-slate-100', 'bg-red-50'); editBtn.classList.replace('text-brand-teal', 'text-red-500');
        } else {
            editBlock.classList.add('hidden'); infoBlock.classList.remove('hidden'); editBtn.innerText = "Modifier";
            editBtn.classList.replace('bg-red-50', 'bg-slate-100'); editBtn.classList.replace('text-red-500', 'text-brand-teal');
        }
    }

    function saveProfileChanges() {
        const firstName = document.getElementById('input-firstname').value;
        const lastName = document.getElementById('input-lastname').value;
        const email = document.getElementById('input-email').value;
        const phone = document.getElementById('input-phone').value;
        document.getElementById('profile-full-name').innerText = firstName + " " + lastName;
        document.getElementById('display-email').innerText = email;
        document.getElementById('display-phone').innerText = phone;
        document.querySelectorAll('.user-firstname').forEach(el => el.innerText = firstName);
        toggleProfileEdit();
        showToast("Profil mis √† jour !");
    }
</script>
</body>
</html>